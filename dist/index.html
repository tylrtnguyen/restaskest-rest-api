<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResTaskest - Restful API</title>
    <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.4.1/minty/bootstrap.min.css" rel="stylesheet" integrity="sha384-4HfFay3AYJnEmbgRzxYWJk/Ka5jIimhB/Fssk7NGT9Tj3rkEChpSxLK0btOGzf2I" crossorigin="anonymous">
</head>
<body>
    <div class="container-fluid">   
        <div class="col-lg-7 col-xl-6 mx-auto">
            <h3 class="display-4">Login to use ResTaskest API</h3> <br>
            <form>
                <div class="form-group">
                    <label for="exampleInputEmail1">Email address</label>
                    <input type="email" class="form-control" id="email" aria-describedby="emailHelp" placeholder="Enter email" name="email">
                    <small id="emailHelp" class="form-text text-muted">We'll share your email with Thong Nguyen</small>
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Password" name="password">
                  </div>
                  <button type="button" onclick="getToken()" class="btn btn-danger btn-block text-uppercase mb-2 rounded-pill shadow-sm">Login</button>
            </form>
            <div class="form-group">
                <label class="col-form-label col-form-label-lg" for="inputLarge">Token section</label>
                <input class="form-control form-control-lg" type="text" placeholder="Your token will be appeared here if you login" id="myToken">
                <!-- The button used to copy the text -->
                <button class="btn btn-primary" onclick="copyText()">Copy token</button>
              </div>  
        </div>
    </div>
    <script>
        function copyText(){
            /* Select the text field */
            const copyToken = document.getElementById("myToken")

            copyToken.select();
            copyToken.setSelectionRange(0, 99999); /*For mobile devices*/

            /* Copy the text inside the text field */
            document.execCommand("copy");

            /* Alert the copied text */
            alert("Copied the token: " + copyToken.value);
        }

        function getToken(){
            const loginUrl = "/login"
            const xhr = new XMLHttpRequest();
            const emailElement = document.getElementById("email")
            const passwordElement = document.getElementById("password")
            const tokenElement = document.getElementById("myToken")
            const email = emailElement.value
            const password = passwordElement.value

            xhr.open('POST', loginUrl, true)

            xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
            xhr.addEventListener('load', function() {
                var responseObject = JSON.parse(this.response);
                console.log(responseObject);
                if (responseObject.token) {
                tokenElement.value = responseObject.token;
                } else {
                tokenElement.value = "No token received";
                }
            });

            const sendObject = JSON.stringify({email: email, password: password});

            console.log('going to send', sendObject);

            xhr.send(sendObject);
        }
    </script>
</body>
</html>